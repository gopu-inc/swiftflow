// ======================================================
// SWIFTFLOW COMPLETE TEST v2.0
// Toutes les fonctionnalités: Types CLAIR & SYM Fusion
// ======================================================

// --------------------------
// SECTION 1: IMPORTS ET MODULES
// --------------------------

// Syntaxe d'import (commentée car pas encore implémentée)
/*
import() {
    "PI", from "math"
}
import() {
    "math",          // Module mathématique
    "json",          // Module JSON
    "./utils"        // Module local
    from "stdlib";   // Depuis la bibliothèque standard
};
*/

// --------------------------
// SECTION 2: TYPES ET CLASSES
// --------------------------

// Type personnalisé avec typelock
typelock {
    PersonType(
        name: string,
        age: int,
        active: bool
    )
} Person;

// Classe avec méthodes
class Animal {
    // Attributs
    var name: string;
    var age: int;
    var weight: float;
    
    // Constructeur
    constructor(name: string, age: int, weight: float) {
        this.name = name;
        this.age = age;
        this.weight = weight;
        print("Animal created: ", this.name);
    }
    
    // Méthodes
    func speak() {
        print(this.name, " makes a sound");
    }
    
    func getInfo() {
        print("Name: ", this.name);
        print("Age: ", this.age, " years");
        print("Weight: ", this.weight, " kg");
    }
    
    // Destructeur
    destructor() {
        print("Animal destroyed: ", this.name);
    }
}

// --------------------------
// SECTION 3: DÉCLARATIONS DE VARIABLES
// --------------------------

// Variables de différents types (CLAIR & SYM)
var entier = 42;
var pi = 3.14159;
var message = "Bienvenue dans SwiftFlow!";
var est_vrai = true;
var est_faux = false;

// Variables spéciales SYM
net adresse_ip = "192.168.1.100";     // Variable réseau
clog log_system = "System started";   // Variable de log
dos big_dataset = 9999999.99;         // Grande donnée
sel option = "advanced_mode";         // Sélection

// Tableaux
var nombres = [1, 2, 3, 4, 5];
var mots = ["hello", "world", "swift", "flow"];
var mixed = [1, "two", 3.0, true];

// Constantes
const MAX_USERS = 100;
const APP_NAME = "SwiftFlow";
const VERSION = 2.0;

// --------------------------
// SECTION 4: FONCTIONS
// --------------------------

// Fonction simple
func saluer(nom: string) {
    print("Bonjour, ", nom, "!");
}

// Fonction avec retour
func addition(a: int, b: int) -> int {
    return a + b;
}

// Fonction récursive
func factorielle(n: int) -> int {
    if (n <= 1) {
        return 1;
    }
    return n * factorielle(n - 1);
}

// Fonction avec plusieurs types de retour
func operations(x: float, y: float) {
    print("x + y = ", x + y);
    print("x - y = ", x - y);
    print("x * y = ", x * y);
    if (y != 0) {
        print("x / y = ", x / y);
    } else {
        print("Division par zéro impossible");
    }
}

// --------------------------
// SECTION 5: STRUCTURES DE CONTRÔLE
// --------------------------

// IF-ELSE-ELIF
func test_if_else(x: int) {
    print("\n=== Test IF-ELSE (x = ", x, ") ===");
    
    if (x > 100) {
        print("x est très grand");
    } elif (x > 50) {
        print("x est grand");
    } elif (x > 10) {
        print("x est moyen");
    } elif (x > 0) {
        print("x est petit");
    } else if (x == 0) {
        print("x est zéro");
    } else {
        print("x est négatif");
    }
}

// WHILE Loop
func test_while() {
    print("\n=== Test WHILE Loop ===");
    
    var compteur = 1;
    while (compteur <= 5) {
        print("Compteur: ", compteur);
        compteur = compteur + 1;
    }
    
    // While avec condition complexe
    var a = 0;
    var b = 10;
    while (a < b && a < 5) {
        print("a = ", a, ", b = ", b);
        a = a + 1;
        b = b - 1;
    }
}

// FOR Loop
func test_for() {
    print("\n=== Test FOR Loop ===");
    
    // For classique
    for (var i = 0; i < 5; i = i + 1) {
        print("i = ", i);
    }
    
    // For avec array
    var fruits = ["pomme", "banane", "orange", "kiwi"];
    for (var j = 0; j < size(fruits); j = j + 1) {
        print("Fruit[", j, "] = ", fruits[j]);
    }
}

// SWITCH-CASE
func test_switch(jour: int) {
    print("\n=== Test SWITCH-CASE (jour = ", jour, ") ===");
    
    switch (jour) {
        case 1:
            print("Lundi");
            break;
        case 2:
            print("Mardi");
            break;
        case 3:
            print("Mercredi");
            break;
        case 4:
            print("Jeudi");
            break;
        case 5:
            print("Vendredi");
            break;
        case 6:
            print("Samedi");
            break;
        case 7:
            print("Dimanche");
            break;
        default:
            print("Jour invalide");
    }
}

// --------------------------
// SECTION 6: OPÉRATIONS AVANCÉES
// --------------------------

// Opérations mathématiques
func operations_mathematiques() {
    print("\n=== Opérations Mathématiques ===");
    
    var a = 15;
    var b = 4;
    
    // Opérations de base
    print("a + b = ", a + b);
    print("a - b = ", a - b);
    print("a * b = ", a * b);
    print("a / b = ", a / b);
    print("a % b = ", a % b);
    print("a ^ b = ", a ^ b);
    
    // Comparaisons
    print("a == b: ", a == b);
    print("a != b: ", a != b);
    print("a > b: ", a > b);
    print("a < b: ", a < b);
    print("a >= b: ", a >= b);
    print("a <= b: ", a <= b);
    
    // Logique
    var x = true;
    var y = false;
    print("x && y: ", x && y);
    print("x || y: ", x || y);
    print("!x: ", !x);
    
    // Opérations bit à bit
    var m = 5;  // 0101
    var n = 3;  // 0011
    print("m & n: ", m & n);   // 0001 = 1
    print("m | n: ", m | n);   // 0111 = 7
    print("m ^ n: ", m ^ n);   // 0110 = 6
    print("~m: ", ~m);
    print("m << 1: ", m << 1); // 1010 = 10
    print("m >> 1: ", m >> 1); // 0010 = 2
}

// Gestion de strings
func manipulation_strings() {
    print("\n=== Manipulation de Strings ===");
    
    var s1 = "Hello";
    var s2 = "World";
    var s3 = "SwiftFlow";
    
    // Concaténation
    print(s1 + " " + s2);
    print(s1, " ", s2, " from ", s3);
    
    // Longueur
    print("Length of '", s1, "': ", size(s1));
    print("Length of '", s3, "': ", size(s3));
}

// --------------------------
// SECTION 7: GESTION DE MÉMOIRE
// --------------------------

func test_memoire() {
    print("\n=== Test Gestion Mémoire ===");
    
    // Allocation dynamique
    var ptr = alloc(100);  // Alloue 100 bytes
    print("Allocated 100 bytes at: ", ptr);
    
    // Taille des variables
    print("\nTaille des variables:");
    print("entier: ", size(entier), " bytes");
    print("pi: ", size(pi), " bytes");
    print("message: ", size(message), " bytes");
    print("adresse_ip: ", size(adresse_ip), " bytes");
    print("big_dataset: ", size(big_dataset), " bytes");
    
    // Libération
    free(ptr);
    print("Memory freed");
}

// --------------------------
// SECTION 8: SYSTÈME DBVAR
// --------------------------

func test_dbvar() {
    print("\n=== Test Système DBVAR ===");
    
    // Afficher toutes les variables
    dbvar;
    
    // Variables spécifiques
    print("\nVariables de type NET:");
    net test_net = 255.255.255.0;
    
    print("\nVariables de type CLOG:");
    clog test_clog = "Debug message";
    
    print("\nVariables de type DOS:");
    dos test_dos = 500000.50;
    
    // Mise à jour et nouvel affichage
    print("\n=== Table DBVAR après mises à jour ===");
    dbvar;
}

// --------------------------
// SECTION 9: FONCTION MAIN PRINCIPALE
// --------------------------

sel main() {
    print("╔══════════════════════════════════════════════════════════════╗");
    print("║          DÉMARRAGE SWIFTFLOW COMPLETE TEST v2.0          ║");
    print("╚══════════════════════════════════════════════════════════════╝");
    
    // ====================
    // PARTIE 1: BASICS
    // ====================
    print("\n" + "="*60);
    print("PARTIE 1: BASICS");
    print("="*60);
    
    print("\nVariables déclarées:");
    print("entier = ", entier);
    print("pi = ", pi);
    print("message = ", message);
    print("est_vrai = ", est_vrai);
    
    print("\nVariables SYM:");
    print("adresse_ip = ", adresse_ip);
    print("log_system = ", log_system);
    print("big_dataset = ", big_dataset);
    print("option = ", option);
    
    // ====================
    // PARTIE 2: FONCTIONS
    // ====================
    print("\n" + "="*60);
    print("PARTIE 2: FONCTIONS");
    print("="*60);
    
    saluer("Développeur");
    
    var resultat = addition(17, 25);
    print("17 + 25 = ", resultat);
    
    var fact5 = factorielle(5);
    print("5! = ", fact5);
    
    operations(10.5, 2.5);
    
    // ====================
    // PARTIE 3: STRUCTURES DE CONTRÔLE
    // ====================
    print("\n" + "="*60);
    print("PARTIE 3: STRUCTURES DE CONTRÔLE");
    print("="*60);
    
    test_if_else(75);
    test_if_else(25);
    test_if_else(0);
    test_if_else(-10);
    
    test_while();
    test_for();
    test_switch(3);
    test_switch(8);
    
    // ====================
    // PARTIE 4: OPÉRATIONS
    // ====================
    print("\n" + "="*60);
    print("PARTIE 4: OPÉRATIONS AVANCÉES");
    print("="*60);
    
    operations_mathematiques();
    manipulation_strings();
    
    // ====================
    // PARTIE 5: MÉMOIRE & DBVAR
    // ====================
    print("\n" + "="*60);
    print("PARTIE 5: MÉMOIRE & SYSTÈME DBVAR");
    print("="*60);
    
    test_memoire();
    test_dbvar();
    
    // ====================
    // PARTIE 6: CLASSES ET OBJETS
    // ====================
    print("\n" + "="*60);
    print("PARTIE 6: CLASSES ET OBJETS");
    print("="*60);
    
    // Création d'objets
    var animal1 = Animal("Rex", 5, 12.5);
    animal1.speak();
    animal1.getInfo();
    
    var animal2 = Animal("Mimi", 3, 4.2);
    animal2.speak();
    animal2.getInfo();
    
    // ====================
    // PARTIE 7: TESTS AVANCÉS
    // ====================
    print("\n" + "="*60);
    print("PARTIE 7: TESTS AVANCÉS");
    print("="*60);
    
    // Test d'expressions complexes
    var complex_result = ((10 + 5) * 3 - 8) / 2;
    print("((10 + 5) * 3 - 8) / 2 = ", complex_result);
    
    // Test de conditions imbriquées
    var score = 85;
    var grade = "";
    
    if (score >= 90) {
        grade = "A";
    } elif (score >= 80) {
        grade = "B";
    } elif (score >= 70) {
        grade = "C";
    } elif (score >= 60) {
        grade = "D";
    } else {
        grade = "F";
    }
    
    print("Score: ", score, ", Grade: ", grade);
    
    // Test de boucle avec break/continue
    print("\nTest BREAK/CONTINUE:");
    for (var k = 1; k <= 10; k = k + 1) {
        if (k == 3) {
            continue;  // Saute 3
        }
        if (k == 8) {
            break;     // Arrête à 8
        }
        print("k = ", k);
    }
    
    // ====================
    // PARTIE 8: FINALISATION
    // ====================
    print("\n" + "="*60);
    print("PARTIE 8: FINALISATION");
    print("="*60);
    
    // Résumé final
    print("\n=== RÉSUMÉ FINAL ===");
    print("Test complet exécuté avec succès!");
    print("Types testés: var, net, clog, dos, sel");
    print("Structures testées: if, elif, else, while, for, switch");
    print("Fonctions testées: déclaration, paramètres, retour");
    print("Classes testées: constructeur, méthodes, destructeur");
    print("Opérations testées: math, logique, bitwise, strings");
    
    // Dernier dbvar
    print("\n=== ÉTAT FINAL DES VARIABLES ===");
    dbvar;
    
    print("\n╔══════════════════════════════════════════════════════════════╗");
    print("║          TEST SWIFTFLOW COMPLETE - TERMINÉ AVEC SUCCÈS     ║");
    print("╚══════════════════════════════════════════════════════════════╝");
    
    return 0;
}

// --------------------------
// SECTION 10: CODE APRÈS MAIN (exécuté si pas de main)
// --------------------------

// Ce code s'exécute si main() n'est pas appelé directement
print("\n=== Code après main ===");
print("Ce message s'affiche si main() n'est pas le point d'entrée");

// Test final rapide
var test_final = 100;
print("Test final valeur: ", test_final);
print("Taille test_final: ", size(test_final), " bytes");